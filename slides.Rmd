---
title: "How to write an R package and publish it on GitHub"
author: "Aya Mitani"
date: "2021/01/07"
output: 
  beamer_presentation:
    slide_level: 3
    keep_tex: true
    includes:
      in_header: preamble.txt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE,
                      class.source = "bg-warning",
                      class.output = "bg-success")
library(available)
library(here)
library(devtools)
```

### What is R package?
- Collection of code, data, documentation developed by R community
- Addresses particular problem with specialized statistical technique, graphical device, etc. 
- Core set of packages come with base R
- $>$ 15,000 Additional packages available from CRAN, Bioconductor, Omegahat, GitHub, etc.
- Popular R packages 
  + `dplyr`
  + `ggplot2`

\begin{figure}
  \includegraphics[scale=0.2]{slides_files/figure-beamer/dplyrggplot2.png}
\end{figure}

### What is GitHub?
- Website that hosts software development and version control using Git
- Free basic services
- Truly open source
- ``Facebook for programmers''

\begin{figure}
  \includegraphics[scale=0.2]{slides_files/figure-beamer/GitHub.png}
\end{figure}

### Why write R package?
* For yourself
  + Save time 
    - Keep track of your functions
    - Have all your functions in one place
  + Document your work
  + For publishing papers
    - Increasingly, (bio)statistical journals ask for R package development of novel method
* For others
  + If package is useful to you, it is also useful to someone else
  + Readers of your paper can use proposed method
  + Advance science!

### Why publish package on GitHub?
- Reproducibility
- Accessibility
- Collaboration
- Back-up method
- Version-control using \alert{git} (more on this later)

### What do you need to write R package?
- R Studio (https://rstudio.com/)
- `devtools` \& `roxygen2`  packages
- Git (install from https://git-scm.com/)
- GitHub account (https://github.com/)

\textcolor{blue}{Some other useful packages}

- `here` 
- `available`

\begin{figure}
  \includegraphics[scale=0.2]{slides_files/figure-beamer/Rstudio.png}
\end{figure}

### Let's begin!
**Major steps**

\small
1. Open R Studio
    i) New Project $\rightarrow$ New Directory $\rightarrow$ R Package $\rightarrow$ Enter info $\rightarrow$ Create Project
2. Write functions 
    i) Each function should be saved in its own file
    ii) Write package description and document functions
3. Create new repo in GitHub
    i) Repo name $=$ package name
4. Connect to GitHub
5. Pull + Commit + Push
6. Use/share package with `install_github()`!

\centering
\alert{There is more than one way!}



<!-- ### Let's begin! -->
<!-- **Major steps** -->

<!-- \small -->
<!-- 1. Open R Studio -->
<!--     i) New Project $\rightarrow$ New Directory $\rightarrow$ New Project $\rightarrow$ Enter info $\rightarrow$ Create Project -->
<!--     ii) Load `devtools`  -->
<!--     iii) Build package with function `devtools::create_package` -->
<!-- 2. Write functions  -->
<!--     i) Each function should be saved in its own file -->
<!-- 3. Create new repo in GitHub -->
<!--     i) Repo name $=$ package name -->
<!-- 4. Connect to GitHub -->
<!-- 5. Pull + Commit + Push -->
<!-- 6. Use/share package with `install_github()`! -->

<!-- \centering -->
<!-- \alert{There is more than one way!} -->


### Naming R package
Some tips:

* Make it simple \& short
* Make it unique (use `available` package -- see next slide)
* Must start with a letter \& cannot end with a period
* Do not use special characters
* Trend towards using all lower case
* Hadley's book has [more information](https://r-pkgs.org/workflows101.html?q=naming#naming)


### Naming R package
Check to see if name is unique, especially if you plan to submit to CRAN
\footnotesize
```{r, eval = FALSE}
install.packages("available")
library(available)
```
```{r}
available("ayapack", browse = FALSE)
```


### In RStudio
* New Project $\rightarrow$ New Directory $\rightarrow$ R Package
  - Enter package name
  - Optional: Select R scripts that include your functions (if you leave blank, a default function is included)
  - Select subdirectory where you want to save the package (location is not too important since the final product will be saved on Github)
  - Check \alert{`Create a git repository`}
  
\begin{figure}
  \includegraphics[scale=0.4]{slides_files/figure-beamer/Rstudio_packagesetup.png}
\end{figure}



### In RStudio
Load libraries
```{r, eval = FALSE}
library(devtools)
library(here)
```

### Turn this project into a package
```{r, eval = FALSE}
devtools::create(here::here())
```
This will create 3 additional files

* DESCRIPTION: This is where all the meta-data about your package goes. You can edit this file manually. 
* NAMESPACE: This file indicates what needs to be exposed to users for your R package. Do not edit this file. 
* R: This is where all your R code goes for your package.


### Add your function
Open new R script and write your function

```{r, eval = FALSE}
myfunc <- function(x){
  y <- x + x
  return(y)
}
```

### Add your function
Include `@export` tag above your function to indicate this function to be “exposed” to users.

```{r, eval = FALSE}
#' @export
myfunc <- function(x){
  y <- x + x
  return(y)
}
```

### Add your function
Also, include documentation for your function when you go `?myfunc`. \small
```{r, eval = FALSE}
#' This is my function.
#'
#' This function returns a value from adding the parameters.
#' @param x
#' @return y
#' @export
myfunc <- function(x){
  y <- x + x
  return(y)
}
```

### Add your function
Now run

```{r, eval = FALSE}
devtools::document()
```

* This will create `man` directory that includes read-only file `myfunc.Rd`
* Note that `NAMESPACE` file has been updated

### Add data set



### In GitHub
First, log in and go to Repositories
\begin{figure}
  \includegraphics[scale=0.275]{slides_files/figure-beamer/GitHub_step1.png}
\end{figure}

### In GitHub
Then, create new repository
\begin{figure}
  \includegraphics[scale=0.275]{slides_files/figure-beamer/GitHub_step2.png}
\end{figure}

### In GitHub
Repo name should be same as package name
\begin{figure}
  \includegraphics[scale=0.275]{slides_files/figure-beamer/GitHub_step3.png}
\end{figure}

### In GitHub
Finish creating new repo
\begin{figure}
  \includegraphics[scale=0.275]{slides_files/figure-beamer/GitHub_step4.png}
\end{figure}

### In GitHub
Finally, copy URL
\begin{figure}
  \includegraphics[scale=0.275]{slides_files/figure-beamer/GitHub_step5.png}
\end{figure}
